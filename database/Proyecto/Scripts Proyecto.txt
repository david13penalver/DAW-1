DROP DATABASE IF EXISTS proyecto;

CREATE DATABASE IF NOT EXISTS proyecto;
USE proyecto;
SHOW TABLES;
-- CREATE table empleado111(id_empleado int primary key, dni char(9) not null UNIQUE key, numero_ss char(12) UNIQUE KEY, email VARCHAR, nombre_via varchar not NULL   );
-- CREATE table empleado111(id_empleado int primary key, dni char(9) not null UNIQUE, numero_ss char(12) UNIQUE not null, email VARCHAR not null, nombre_via varchar not NULL);

CREATE table empleado111(id_empleado int primary key, dni char(9) not null UNIQUE, numero_ss char(12) UNIQUE, email VARCHAR(50), nombre_via varchar(20) not NULL);

alter TABLE empleado111 add localidad varchar(50);
DESCRIBE empleado111;
alter table empleado111 MODIFY email VARCHAR(50) not NULL;
alter table empleado111 MODIFY numero_ss char(12) UNIQUE not NULL;
-- alter table empleado111 MODIFY  localidad varchar(50) not NULL;
create table empleado112(localidad varchar(50) primary key, provincia varchar(20) not null);
SHOW TABLES;
DESC empleado112;
CREATE table empleado12(dni varchar(9) primary key, nombre varchar(50) not null, apellido1 varchar(50) not null, apellido2 varchar(50));
create table empleado2(telefono int(9), id_empleado int, PRIMARY key(telefono, id_empleado));
CREATE Table tecnico(id_empleado int PRIMARY key, departamento varchar(20) not null);
CREATE Table atencion_cliente(id_empleado int PRIMARY key, turnop_trabajo varchar(20) not null);
CREATE Table transportista(id_empleado int PRIMARY key, area varchar(20) not null);
CREATE table reparacion(id_reparacion int PRIMARY key, descripcion_reparacion varchar(200) NULL, fecha_inicio DATETIME not null, fecha_final DATETIME not NULL, id_empleado int);
create table tarea(id_tarea int, id_reparacion int, descripcion_tarea varchar(500) not NULL, PRIMARY key(id_tarea,id_reparacion));
create table producto(id_producto int PRIMARY key, nombre VARCHAR(50) not NULL, descripcion varchar(500) NOT null, id_empleado int);
CREATE table cliente11(id_cliente int PRIMARY key, tipo_via varchar(15) not null, nombre_via varchar(50) not null, poblacion varchar(40) references poblacion, email varchar(40) not null, id_producto int references id_producto, dni varchar(9), telefono int(9));
create table cliente12(poblacion varchar(40) PRIMARY key, provincia varchar(40) not null);

create table cliente2(dni char(9) PRIMARY key, nombre varchar(50) not null, apellido1 varchar(50) not null, apellido2 varchar(50));
create table pieza1(nombre varchar(50) primary key, tipo varchar(50) not null);
create Table pieza2(id_pieza int primary key, codigo_barras varchar(30) not null, nombre varchar(150) not null, precio DECIMAL(6,2) not null);
create table proveedor(id_proveedor int primary key, cif char(9), calificacion int, nombre varchar(50) not null );
create Table adquiere(id_pieza int, id_empleado int, primary key(id_pieza,id_empleado));
create table consulta(id_cliente int, id_empleado int, primary key(id_cliente,id_empleado));
CREATE table utiliza(id_pieza int, id_tarea int, primary key(id_pieza,id_tarea));
create table compradas(id_pieza int, id_proveedor int, primary key(id_pieza,id_proveedor));
show TABLES;
alter table empleado111 add CONSTRAINT foreign key(dni) references empleado12(dni);
alter table empleado111 add CONSTRAINT foreign key(localidad) references empleado112(localidad);
alter table tecnico add CONSTRAINT foreign key(id_empleado) references empleado111(id_empleado);
alter table atencion_cliente add CONSTRAINT foreign key(id_empleado) references empleado111(id_empleado);
alter table transportista add CONSTRAINT foreign key(id_empleado) references empleado111(id_empleado);
desc table transportista;
alter table compradas add CONSTRAINT foreign key(id_pieza) references pieza2(id_pieza);
alter table compradas add CONSTRAINT foreign key(id_proveedor) references proveedor(id_proveedor);
drop table pieza1;
create table pieza1(nombre varchar(150) PRIMARY key, tipo varchar(50) not null, descripcion varchar(500) not null);
desc pieza2;
desc adquiere;
alter table pieza2 add constraint FOREIGN key(nombre) REFERENCES pieza1(nombre);
alter table adquiere add CONSTRAINT foreign key(id_pieza) references pieza2(id_pieza);
alter table adquiere add CONSTRAINT foreign key(id_empleado) references tecnico(id_empleado);
alter table utiliza add CONSTRAINT foreign key(id_pieza) references pieza2(id_pieza);
desc utiliza;
alter table empleado2 add CONSTRAINT foreign key(id_empleado) references empleado111(id_empleado);
alter TABLE utiliza add CONSTRAINT FOREIGN KEY(id_pieza) REFERENCES pieza2(id_pieza);
alter TABLE utiliza add CONSTRAINT FOREIGN KEY(id_tarea) REFERENCES tarea(id_tarea);
DESCRIBE reparacion;
alter TABLE reparacion add CONSTRAINT FOREIGN KEY(id_empleado) REFERENCES empleado111(id_empleado);
alter TABLE reparacion modify descripcion_reparacion varchar(500) not null;
alter table producto add constraint foreign key(id_empleado) references empleado111(id_empleado);
alter table cliente11 add CONSTRAINT FOREIGN KEY(dni) REFERENCES cliente2(dni);
